<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Solar Project Dashboard</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial; margin: 20px; text-align: center; }
    h2 { margin-top: 30px; }
    canvas { max-width: 800px; margin: auto; }
    .box { margin: 10px auto; padding: 10px; border: 1px solid #ccc; max-width: 500px; }
    .value { font-weight: bold; }
  </style>
</head>
<body>
  <h1>Solar Project Dashboard</h1>

  <!-- Input -->
  <h2>Input Parameters</h2>
  <canvas id="inputChart" width="800" height="400"></canvas>
  <div class="box">
    Voltage: <span id="inV" class="value">0</span> V <br>
    Current: <span id="inC" class="value">0</span> A <br>
    Power: <span id="inP" class="value">0</span> W
  </div>

  <!-- Output -->
  <h2>Output Parameters</h2>
  <canvas id="outputChart" width="800" height="400"></canvas>
  <div class="box">
    Voltage: <span id="outV" class="value">0</span> V <br>
    Current: <span id="outC" class="value">0</span> A <br>
    Power: <span id="outP" class="value">0</span> W
  </div>

  <!-- System -->
  <h2>System Parameters</h2>
  <div class="box">
    Efficiency: <span id="eff" class="value">0</span> %
  </div>

  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyBMtJC2oWeMJQGeOihAewpiYwwD7QXjf-k",
      authDomain: "esp32-test3-5bbeb.firebaseapp.com",
      databaseURL: "https://esp32-test3-5bbeb-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "esp32-test3-5bbeb",
      storageBucket: "esp32-test3-5bbeb.firebasestorage.app",
      messagingSenderId: "948392507591",
      appId: "1:948392507591:web:9a84027b7e9474fada26e2"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Chart setup
    function createChart(ctx, label1, label2, label3, color1, color2, color3) {
      return new Chart(ctx, {
        type: "line",
        data: {
          labels: [],
          datasets: [
            { label: label1, borderColor: color1, data: [], fill: false },
            { label: label2, borderColor: color2, data: [], fill: false },
            { label: label3, borderColor: color3, data: [], fill: false }
          ]
        },
        options: {
          responsive: true,
          animation: false,
          scales: {
            x: { title: { display: true, text: "Time" } },
            y: { title: { display: true, text: "Value" } }
          }
        }
      });
    }

    const inputChart = createChart(document.getElementById("inputChart"), "Voltage", "Current", "Power", "blue", "green", "orange");
    const outputChart = createChart(document.getElementById("outputChart"), "Voltage", "Current", "Power", "red", "purple", "brown");

    // Firebase listener
    db.ref().on("value", snap => {
    const data = snap.val();
    if (!data) return;
  
    const now = new Date().toLocaleTimeString();

    // Input update
    inputChart.data.labels.push(now);
    inputChart.data.datasets[0].data.push(data.input.input_voltage || 0);
    inputChart.data.datasets[1].data.push(data.input.input_current || 0);
    inputChart.data.datasets[2].data.push(data.input.input_power || 0);
    if (inputChart.data.labels.length > 20) {
      inputChart.data.labels.shift();
      inputChart.data.datasets.forEach(ds => ds.data.shift());
    }
    inputChart.update();
  
    document.getElementById("inV").textContent = (data.input.input_voltage || 0).toFixed(2);
    document.getElementById("inC").textContent = (data.input.input_current || 0).toFixed(2);
    document.getElementById("inP").textContent = (data.input.input_power || 0).toFixed(2);
  
    // Output update
    outputChart.data.labels.push(now);
    outputChart.data.datasets[0].data.push(data.output.output_voltage || 0);
    outputChart.data.datasets[1].data.push(data.output.output_current || 0);
    outputChart.data.datasets[2].data.push(data.output.output_power || 0);
    if (outputChart.data.labels.length > 20) {
      outputChart.data.labels.shift();
      outputChart.data.datasets.forEach(ds => ds.data.shift());
    }
    outputChart.update();
  
    document.getElementById("outV").textContent = (data.output.output_voltage || 0).toFixed(2);
    document.getElementById("outC").textContent = (data.output.output_current || 0).toFixed(2);
    document.getElementById("outP").textContent = (data.output.output_power || 0).toFixed(2);
  
    // Efficiency update
    document.getElementById("eff").textContent = (data.system.system_efficiency || 0).toFixed(2);
    });
  </script>
</body>
</html>




