<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Solar Project Dashboard</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial; margin: 20px; text-align: center; }
    h2 { margin-top: 30px; }
    canvas { max-width: 800px; margin: auto; }
    .box { margin: 10px auto; padding: 10px; border: 1px solid #ccc; max-width: 500px; }
    .value { font-weight: bold; }
  </style>
</head>
<body>
  <h1>Solar Project Dashboard</h1>

  <!-- Voltage -->
  <h2>Voltage</h2>
  <canvas id="voltageChart" width="800" height="400"></canvas>
  <div class="box">
    Input Voltage: <span id="inV" class="value">0</span> V |
    Output Voltage: <span id="outV" class="value">0</span> V
  </div>

  <!-- Current -->
  <h2>Current</h2>
  <canvas id="currentChart" width="800" height="400"></canvas>
  <div class="box">
    Input Current: <span id="inC" class="value">0</span> A |
    Output Current: <span id="outC" class="value">0</span> A
  </div>

  <!-- Power & Efficiency -->
  <h2>Power and Efficiency</h2>
  <canvas id="powerChart" width="800" height="400"></canvas>
  <div class="box">
    Input Power: <span id="inP" class="value">0</span> W |
    Output Power: <span id="outP" class="value">0</span> W |
    Efficiency: <span id="eff" class="value">0</span> %
  </div>

  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyBMtJC2oWeMJQGeOihAewpiYwwD7QXjf-k",
      authDomain: "esp32-test3-5bbeb.firebaseapp.com",
      databaseURL: "https://esp32-test3-5bbeb-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "esp32-test3-5bbeb",
      storageBucket: "esp32-test3-5bbeb.firebasestorage.app",
      messagingSenderId: "948392507591",
      appId: "1:948392507591:web:9a84027b7e9474fada26e2"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Chart creator
    function createChart(ctx, datasets) {
      return new Chart(ctx, {
        type: "line",
        data: {
          labels: [],
          datasets: datasets
        },
        options: {
          responsive: true,
          animation: false,
          scales: {
            x: { title: { display: true, text: "Time" } },
           
          }
        }
      });
    }

    // Charts
    const voltageChart = createChart(document.getElementById("voltageChart"), [
      { label: "Input Voltage", borderColor: "blue", data: [], fill: false },
      { label: "Output Voltage", borderColor: "red", data: [], fill: false }
       { label: "Efficiency (%)", borderColor: "black", data: [], fill: false, yAxisID: 'y' }
    ]);

    const currentChart = createChart(document.getElementById("currentChart"), [
      { label: "Input Current", borderColor: "green", data: [], fill: false },
      { label: "Output Current", borderColor: "orange", data: [], fill: false }
       { label: "Efficiency (%)", borderColor: "black", data: [], fill: false, yAxisID: 'y' }
    ]);

    const powerChart = createChart(document.getElementById("powerChart"), [
      { label: "Input Power", borderColor: "purple", data: [], fill: false },
      { label: "Output Power", borderColor: "brown", data: [], fill: false },
      { label: "Efficiency (%)", borderColor: "black", data: [], fill: false, yAxisID: 'y1' }
      { label: "Efficiency (%)", borderColor: "black", data: [], fill: false, yAxisID: 'y2' }
    ]);

    voltageChart.options.scales.y1 = {
      position: 'left',
      title: { display: true, text: 'Voltage (V)' },
      min: 0,
      max: 25
    };
    currentChart.options.scales.y1 = {
      position: 'left',
      title: { display: true, text: 'Current (mA)' },
      min: 0,
      max: 1000
    };

    powerChart.options.scales.y1 = {
      position: 'left',
      title: { display: true, text: 'Power (W)' },
      min: 0,
      max: 50
    };
    powerChart.options.scales.y1 = {
      position: 'right',
      title: { display: true, text: 'Efficiency (%)' },
      min: 0,
      max: 100
    };

    

    // Firebase listener
    db.ref().on("value", snap => {
      const data = snap.val();
      if (!data) return;
      const now = new Date().toLocaleTimeString();

      // Voltage chart
      voltageChart.data.labels.push(now);
      voltageChart.data.datasets[0].data.push(data.input.input_voltage || 0);
      voltageChart.data.datasets[1].data.push(data.output.output_voltage || 0);
      if (voltageChart.data.labels.length > 20) {
        voltageChart.data.labels.shift();
        voltageChart.data.datasets.forEach(ds => ds.data.shift());
      }
      voltageChart.update();
      document.getElementById("inV").textContent = (data.input.input_voltage || 0).toFixed(2);
      document.getElementById("outV").textContent = (data.output.output_voltage || 0).toFixed(2);

      // Current chart
      currentChart.data.labels.push(now);
      currentChart.data.datasets[0].data.push(data.input.input_current || 0);
      currentChart.data.datasets[1].data.push(data.output.output_current || 0);
      if (currentChart.data.labels.length > 20) {
        currentChart.data.labels.shift();
        currentChart.data.datasets.forEach(ds => ds.data.shift());
      }
      currentChart.update();
      document.getElementById("inC").textContent = (data.input.input_current || 0).toFixed(2);
      document.getElementById("outC").textContent = (data.output.output_current || 0).toFixed(2);

      // Power chart
      powerChart.data.labels.push(now);
      powerChart.data.datasets[0].data.push(data.input.input_power || 0);
      powerChart.data.datasets[1].data.push(data.output.output_power || 0);
      powerChart.data.datasets[2].data.push(data.system.system_efficiency || 0);
      if (powerChart.data.labels.length > 20) {
        powerChart.data.labels.shift();
        powerChart.data.datasets.forEach(ds => ds.data.shift());
      }
      powerChart.update();
      document.getElementById("inP").textContent = (data.input.input_power || 0).toFixed(2);
      document.getElementById("outP").textContent = (data.output.output_power || 0).toFixed(2);
      document.getElementById("eff").textContent = (data.system.system_efficiency || 0).toFixed(2);
    });
  </script>
</body>
</html>

